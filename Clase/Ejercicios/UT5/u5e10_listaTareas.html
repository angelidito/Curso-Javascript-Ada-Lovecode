<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>u5e10_listaTareas</title>
    <style>
        * {
            color: rgb(255, 255, 255);
            background-color: rgb(22, 22, 22);
        }
    </style>
</head>

<body>
    <script>
        // Crea una pequeña aplicación web para crear y mantener una lista de las tareas que tengamos pendientes.
        n = 0;

        document.addEventListener('DOMContentLoaded', () => {

            // Elemetos HTML
            textArea = document.getElementById('nuevaTarea');
            lista = document.getElementById('tareas');

            // Recuperamos las tareas de localStorage
            recuperarTareas();
            // Aquí se guardan durante la ejecución y se actualiza el localStorage cada vez que se añade una tarea:
            tareas = [];

            // Eventos de los botones:
            //  - para añadir la tarea (solo si hay algo en el textArea)
            document.getElementById('añadir').addEventListener('click', () => {
                if (textArea.value != '')
                    añadirTarea();
                textArea.focus();
            });
            //  - para eliminar todas las tareas existentes
            document.getElementById('eliminarTodas').addEventListener('click', eliminarTodasLasTareas);

        });


        // Añadie una tarea a la lista. Si no se le pasa un parámetro añade el contenido del textarea como tarea, pero si este está también vacío, no hará nada.
        function añadirTarea(tarea = '') {
            console.log('tarea a añadir: '+ tarea);
            if (tarea == '')
                tarea = textArea.value;

            if (tarea != '') {

                // Actualizamos las tareas en el local storage
                tareas.push(tarea);
                console.log('array treas: '+tareas);
                guardarTareas();

                //  - Las tareas se mostrarán dentro de una lista <ul> 
                let li = document.createElement('li');
                // Introducimos el texto
                li.innerHTML= tarea;
                // Reseteamos el valor del textarea
                textArea.value = '';


                // Boton que permite eliminar la tarea
                let botonEliminar = document.createElement('button');
                botonEliminar.innerHTML = 'Eliminar tarea';

                //  Evento del botón para eliminar la tarea asociada
                botonEliminar.addEventListener('click', elimiarTarea);

                // div contenedor del elemento de la lista y del botón
                let div = document.createElement('div');

                // Añadimos al arbol
                li.appendChild(botonEliminar);
                div.appendChild(li);
                lista.appendChild(div);
            }
        }

        //  - E irán junto a un icono que, al hacer clic sobre él, nos permitirá eliminar solamente la tarea correspondiente.
        function elimiarTarea(e) {
            console.log(n++);
            let div = e.target.parentNode;
            div.remove();
        }

        function eliminarTodasLasTareas() {

            // Borrarmos los li de lul
            lista.innerHTML = '';

            // Vaciamos el array tareas
            tareas = []
            // Guardamos el array vacío en el localStorege usando la función de JSON.
            // Podria darle valor null o undefined ya que lo contemplo en la función recuperarTareas(), pero vamos a hacer las cosas ''bien''. Vamos a dejar eso sólo para la primera ejecución de la aplicación.
            localStorage.setItem('tareas-u5e10_listaTareas', JSON.stringify(tareas));

            // Foco del teclaro al textarea
            textArea.focus();
        }

        // Una vez que compruebes que todo funciona bien, modifica el programa para que no se pierdan las tareas cada vez que cerramos el navegador. 
        // Para ello, podemos utilizar localStorage.
        //  * Para almacenar las tareas, se puede crear un array de strings y se puede utilizar JSON.stringify(miArray) que devuelve una cadena que se puede almacenar con localStorage.
        function guardarTareas() {

            localStorage.setItem('tareas-u5e10_listaTareas', JSON.stringify(tareas));

            console.log('guardarTareas()\nAhora el localStorage contiene: '+localStorage.getItem('tareas-u5e10_listaTareas'));
        }

        //  * Para obtener el array de nuevo desde la cadena almacenada, puedes utilizar JSON.parse(varLocalStorage).
        function recuperarTareas() {
            console.log('recuperarTareas ' + n++);
            // Para evitar errores la primera vez que se inicia la aplicación,
            // hacemos una pequeña comprobación:
            let valorAlmacenado = localStorage.getItem('tareas-u5e10_listaTareas');
            if (valorAlmacenado != undefined && valorAlmacenado != null) {
                ;
                for (let i = 0; i < JSON.parse(valorAlmacenado).length; i++) {
                    const t = tareas[i];
                    console.log('BUCLE recuperarTareas\nRecuperando: ' + t);
                    añadirTarea(t);
                }
            }





        }
    </script>
    <!-- La página constará de un formulario con: -->
    <form>

        <!-- - una caja de texto para indicar el nombre de la tarea,  -->
        <textarea name="tarea" id="nuevaTarea" cols="40" rows="3" placeholder="Nueva tarea..." autofocus></textarea>

        <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

        <!-- - un botón Añadir para añadir la tarea -->
        <input type="button" id="añadir" value="Añadir tarea">
        &nbsp;&nbsp;

        <!-- - y otro  Eliminar todas   para eliminar todas las tareas existentes. -->
        <input type="button" id="eliminarTodas" value="Eliminar todas las tareas">

    </form>


    <ul id="tareas">
        <!-- Por otro lado:
                - las tareas se mostrarán dentro de una lista <ul> 
                - e irán junto a un icono que, al hacer clic sobre él, nos permitirá eliminar solamente la tarea correspondiente.
        -->
    </ul>


</body>

</html>